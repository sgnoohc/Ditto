#!/bin/bash

ERROR=echo
UL=echo
SUCCESS=echo
MSG=echo
if [ -d "$HOME/login" ]; then
  LOGINEXISTS=true;
  source ~/login/bash/utils.sh
  ERROR=e_error
  UL=e_underline
  SUCCESS=e_success
  MSG=e_msg
fi

usage()
{
  echo "Usage:"
  echo ""
  echo "   $0 TREECLASSNAME TREEINSTANCENAMEINROOTFILE"
  echo ""
  echo "   e.g. MT2Tree mt2"
  exit
}

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"; $DIR/ditto_setup_check QUIET; if [ $? -eq 1 ]; then exit; fi
if [ -z $1 ]; then usage; fi
if [ -z $2 ]; then usage; fi

TREECLASSNAME=$1
TREECLASSNAMESHORT=$2

if [ -e ${PACKAGEPATH}/src/${TREECLASSNAME}Looper.h ]; then
  $ERROR "A looper already exists! exiting..."
  exit
fi

if [ -e ${PACKAGEPATH}/src/${TREECLASSNAME}Looper.cxx ]; then
  $ERROR "A looper already exists! exiting..."
  exit
fi

$MSG "copying template tree loopers to the package directory..."

# Copy TREELooper
sed "s/TEMPLATETREENAME/${TREECLASSNAME}/" $DIR/../template/TEMPLATETREELooper.h > ${PACKAGEPATH}/src/${TREECLASSNAME}Looper.h
sed "s/TEMPLATETREENAME/${TREECLASSNAME}/" $DIR/../template/TEMPLATETREELooper.cxx > /tmp/tmp.cxx
sed "s/TEMPLATETREESHORTNAME/${TREECLASSNAMESHORT}/" /tmp/tmp.cxx > ${PACKAGEPATH}/src/${TREECLASSNAME}Looper.cxx

# Copy Binary
sed "s/TEMPLATETREENAME/${TREECLASSNAME}/" $DIR/../template/BINARYNAME.h   > /tmp/tmp.cxx
sed "s/BINARYNAME/${BINARYNAME}/"          /tmp/tmp.cxx                    > ${PACKAGEPATH}/src/${BINARYNAME}.h
sed "s/TEMPLATETREENAME/${TREECLASSNAME}/" $DIR/../template/BINARYNAME.cxx > /tmp/tmp.cxx
sed "s/BINARYNAME/${BINARYNAME}/"          /tmp/tmp.cxx                    > /tmp/tmp2.cxx
sed "s/TEMPLATETREESHORTNAME/${TREECLASSNAMESHORT}/" /tmp/tmp2.cxx         > ${PACKAGEPATH}/src/${BINARYNAME}.cxx

# Copy TREEConnector
sed "s/TREECLASSNAME/${TREECLASSNAME}/" $DIR/../template/TEMPLATETREEConnector.h > ${PACKAGEPATH}/src/${TREECLASSNAME}Connector.h
sed "s/TREECLASSNAME/${TREECLASSNAME}/" $DIR/../template/TEMPLATETREEConnector.cxx > ${PACKAGEPATH}/src/${TREECLASSNAME}Connector.cxx
